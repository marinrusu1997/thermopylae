<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@thermopylae/lib.geoip</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<ul class="results-priority" style="display:none">
					</ul>
					<a href="index.html" class="title">@thermopylae/lib.geoip</a>
					&emsp;<a href="https://github.com/marinrusu1997/thermopylae/tree/master/packages/lib.geoip" class="title">Github</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
			</ul>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-3 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation outline primary">
				<a style="margin-left:0em" href="modules.html">Modules</a>
				<ul style="display:none">
					{&quot;Locator&quot;:&quot;geoip&quot;,&quot;Error&quot;:&quot;error&quot;,&quot;Repositories&quot;:{&quot;Interface&quot;:&quot;repository&quot;,&quot;GeoIpLiteRepository&quot;:&quot;repository_geoip_lite&quot;,&quot;IpLocateRepository&quot;:&quot;repository_iplocate&quot;,&quot;IpstackRepository&quot;:&quot;repository_ipstack&quot;}}
				</ul>
			</nav>
		</div>
		<div class="col-7 offset-3 col-content">
			<h1>@thermopylae/lib.geoip</h1>
			<div class="tsd-panel tsd-typography">
				<h1 align="center">@thermopylae/lib.geoip</h1>
				<p>
					<img alt="Version" src="https://img.shields.io/badge/version-0.0.1-blue.svg?cacheSeconds=2592000" />
					<img alt="Node Version" src="https://img.shields.io/badge/node-%3E%3D16-blue.svg"/>
					<a href="https://marinrusu1997.github.io/thermopylae/lib.geoip/index.html" target="_blank">
						<img alt="Documentation" src="https://img.shields.io/badge/documentation-yes-brightgreen.svg" />
					</a>
					<a href="https://github.com/marinrusu1997/thermopylae/blob/master/LICENSE" target="_blank">
						<img alt="License: MIT" src="https://img.shields.io/badge/License-MIT-yellow.svg" />
					</a>
				</p>
				<blockquote>
					<p>Geolocation based on ip address.</p>
				</blockquote>
				<a href="#install" id="install" style="color: inherit; text-decoration: none;">
					<h2>Install</h2>
				</a>
				<pre><code class="language-sh"><span style="color: #000000">npm install @thermopylae/lib.geoip</span>
</code></pre>
				<a href="#description" id="description" style="color: inherit; text-decoration: none;">
					<h2>Description</h2>
				</a>
				<p>This package allows you to retrieve location of the ip by using <a href="https://marinrusu1997.github.io/thermopylae/lib.geoip/classes/geoip.geoiplocator.html">GeoIpLocator</a>. <br/>
					This class allows you to register a set of repositories from where location of the ip can be retrieved.
					When location is requested, it will load balance request to one of these repositories in order to retrieve it.
				Three repositories are implemented by default:</p>
				<ul>
					<li><a href="https://marinrusu1997.github.io/thermopylae/lib.geoip/modules/repository_geoip_lite.html">GeoIpLiteRepository</a></li>
					<li><a href="https://marinrusu1997.github.io/thermopylae/lib.geoip/modules/repository_iplocate.html">IpLocateRepository</a></li>
					<li><a href="https://marinrusu1997.github.io/thermopylae/lib.geoip/modules/repository_ipstack.html">IpstackRepository</a></li>
				</ul>
				<p>You can also create your own repository by implementing <a href="https://marinrusu1997.github.io/thermopylae/lib.geoip/modules/repository.html">IpLocationsRepository</a> interface.</p>
				<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
					<h2>Usage</h2>
				</a>
				<pre><code class="language-typescript"><span style="color: #AF00DB">import</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">GeoIpLocator</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">GeoIpLiteRepository</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">IpstackRepository</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">IpstackSubscriptionPlan</span>
<span style="color: #000000">} </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;@thermopylae/lib.geoip&#039;</span><span style="color: #000000">;</span>

<span style="color: #000000">(</span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">main</span><span style="color: #000000">() {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">geoip</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">GeoIpLocator</span><span style="color: #000000">([</span>
<span style="color: #000000">        </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">GeoIpLiteRepository</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">),</span>
<span style="color: #000000">        </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">IpstackRepository</span><span style="color: #000000">({</span>
<span style="color: #000000">            </span><span style="color: #001080">apiKey:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;IPSTACK_ACCESS_KEY&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #001080">lang:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;en&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #001080">plan:</span><span style="color: #000000"> </span><span style="color: #001080">IpstackSubscriptionPlan</span><span style="color: #000000">.</span><span style="color: #0070C1">FREE</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #001080">weight:</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #001080">hooks:</span><span style="color: #000000"> {</span>
<span style="color: #000000">                </span><span style="color: #795E26">onIpRetrievalError</span><span style="color: #000000">(</span><span style="color: #001080">err</span><span style="color: #000000">) {</span>
<span style="color: #000000">                    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">error</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;Failed to retrieve location from ipstack &#039;</span><span style="color: #000000">, </span><span style="color: #001080">err</span><span style="color: #000000">);</span>
<span style="color: #000000">                }</span>
<span style="color: #000000">            }</span>
<span style="color: #000000">        }),</span>
<span style="color: #000000">        </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">IpLocateRepository</span><span style="color: #000000">({</span>
<span style="color: #000000">            </span><span style="color: #001080">apiKey:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;IP_LOCATE_ACCESS_KEY&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #001080">weight:</span><span style="color: #000000"> </span><span style="color: #098658">3</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #001080">hooks:</span><span style="color: #000000"> {</span>
<span style="color: #000000">                </span><span style="color: #795E26">onIpRetrievalError</span><span style="color: #000000">(</span><span style="color: #001080">err</span><span style="color: #000000">) {</span>
<span style="color: #000000">                    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">error</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;Failed to retrieve location from iplocate &#039;</span><span style="color: #000000">, </span><span style="color: #001080">err</span><span style="color: #000000">);</span>
<span style="color: #000000">                },</span>
<span style="color: #000000">                </span><span style="color: #795E26">onRateLimitExceeded</span><span style="color: #000000">(</span><span style="color: #001080">rateLimitReset</span><span style="color: #000000">) {</span>
<span style="color: #000000">                    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">info</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;Iplocate Rate limit reset at &#039;</span><span style="color: #000000">, </span><span style="color: #001080">rateLimitReset</span><span style="color: #000000">);</span>
<span style="color: #000000">                }</span>
<span style="color: #000000">            }</span>
<span style="color: #000000">        })</span>
<span style="color: #000000">    ]);</span>
<span style="color: #000000">    </span>
<span style="color: #000000">    </span><span style="color: #008000">// retrieve location from random repository</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">firstLookup</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">geoip</span><span style="color: #000000">.</span><span style="color: #795E26">locate</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;8.8.8.8&#039;</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">firstLookup</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span>
<span style="color: #000000">    </span><span style="color: #008000">// retrieve from same repository again so that location objects are the same</span>
<span style="color: #000000">    </span><span style="color: #008000">// you are not required to specify &#039;repository-id&#039;, in this case a random repository will be selected</span>
<span style="color: #000000">    </span><span style="color: #008000">// which may provide a location a bit different from the previous one for same ip</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">secondLookup</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">geoip</span><span style="color: #000000">.</span><span style="color: #795E26">locate</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;8.8.8.8&#039;</span><span style="color: #000000">, </span><span style="color: #001080">firstLookup</span><span style="color: #000000">.</span><span style="color: #0070C1">REPOSITORY_ID</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">secondLookup</span><span style="color: #000000">);</span>
<span style="color: #000000">})();</span>
</code></pre>
				<a href="#api-reference" id="api-reference" style="color: inherit; text-decoration: none;">
					<h2>API Reference</h2>
				</a>
				<p>API documentation is available <a href="https://marinrusu1997.github.io/thermopylae/lib.geoip/index.html">here</a>.</p>
				<p>It can also be generated by issuing the following commands:</p>
				<pre><code class="language-shell"><span style="color: #000000">git clone git@github.com:marinrusu1997/thermopylae.git</span>
<span style="color: #795E26">cd</span><span style="color: #000000"> thermopylae</span>
<span style="color: #000000">yarn install</span>
<span style="color: #000000">yarn workspace @thermopylae/lib.geoip run doc</span>
</code></pre>
				<a href="#author" id="author" style="color: inherit; text-decoration: none;">
					<h2>Author</h2>
				</a>
				<p>👤 <strong>Rusu Marin</strong></p>
				<ul>
					<li>GitHub: <a href="https://github.com/marinrusu1997">@marinrusu1997</a></li>
					<li>Email: <a href="mailto:dimarusu2000@gmail.com">dimarusu2000@gmail.com</a></li>
					<li>LinkedIn: <a href="https://www.linkedin.com/in/rusu-marin-1638b0156/">@marinrusu1997</a></li>
				</ul>
				<a href="#📝-license" id="📝-license" style="color: inherit; text-decoration: none;">
					<h2>📝 License</h2>
				</a>
				<p>Copyright © 2021 <a href="https://github.com/marinrusu1997">Rusu Marin</a>. <br/>
				This project is <a href="https://github.com/marinrusu1997/thermopylae/blob/master/LICENSE">MIT</a> licensed.</p>
			</div>
			<!--{&quot;options&quot;:&quot;/home/marin/secondary-hard-drive/node-projects/framework/packages/lib.geoip&quot;,&quot;tsconfig&quot;:&quot;/home/marin/secondary-hard-drive/node-projects/framework/packages/lib.geoip&quot;,&quot;entryPoints&quot;:[&quot;lib/&quot;],&quot;exclude&quot;:[&quot;test/**/*&quot;,&quot;lib/index.ts&quot;,&quot;lib/load-balancer.ts&quot;],&quot;externalPattern&quot;:[&quot;**/node_modules/**&quot;],&quot;excludeExternals&quot;:true,&quot;excludeNotDocumented&quot;:false,&quot;excludeInternal&quot;:false,&quot;excludePrivate&quot;:true,&quot;excludeProtected&quot;:true,&quot;disableSources&quot;:true,&quot;disableAliases&quot;:false,&quot;includes&quot;:&quot;&quot;,&quot;media&quot;:&quot;&quot;,&quot;watch&quot;:false,&quot;preserveWatchOutput&quot;:false,&quot;emit&quot;:false,&quot;out&quot;:&quot;doc/html&quot;,&quot;json&quot;:&quot;doc/json/index.json&quot;,&quot;pretty&quot;:true,&quot;theme&quot;:&quot;/home/marin/secondary-hard-drive/node-projects/framework/node_modules/typedoc-neo-theme/bin/default&quot;,&quot;highlightTheme&quot;:&quot;light-plus&quot;,&quot;name&quot;:&quot;&quot;,&quot;includeVersion&quot;:false,&quot;excludeTags&quot;:[],&quot;readme&quot;:&quot;README.md&quot;,&quot;defaultCategory&quot;:&quot;Other&quot;,&quot;categoryOrder&quot;:[],&quot;categorizeByGroup&quot;:true,&quot;gitRevision&quot;:&quot;&quot;,&quot;gitRemote&quot;:&quot;origin&quot;,&quot;gaID&quot;:&quot;&quot;,&quot;gaSite&quot;:&quot;auto&quot;,&quot;hideGenerator&quot;:true,&quot;toc&quot;:[],&quot;disableOutputCheck&quot;:false,&quot;help&quot;:false,&quot;version&quot;:false,&quot;showConfig&quot;:false,&quot;plugin&quot;:[&quot;typedoc-neo-theme&quot;],&quot;logger&quot;:&quot;console&quot;,&quot;logLevel&quot;:1,&quot;listInvalidSymbolLinks&quot;:true,&quot;links&quot;:[{&quot;label&quot;:&quot;Github&quot;,&quot;url&quot;:&quot;https://github.com/marinrusu1997/thermopylae/tree/master/packages/lib.geoip&quot;}],&quot;outline&quot;:[{&quot;Locator&quot;:&quot;geoip&quot;,&quot;Error&quot;:&quot;error&quot;,&quot;Repositories&quot;:{&quot;Interface&quot;:&quot;repository&quot;,&quot;GeoIpLiteRepository&quot;:&quot;repository_geoip_lite&quot;,&quot;IpLocateRepository&quot;:&quot;repository_iplocate&quot;,&quot;IpstackRepository&quot;:&quot;repository_ipstack&quot;}}]}-->
		</div>
		<div class="col-2 col-menu secondary-menu">
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer>
</footer>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>